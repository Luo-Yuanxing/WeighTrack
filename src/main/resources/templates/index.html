<!DOCTYPE HTML>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>鸿聚一号煤场出库明细</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootstrap-datetimepicker.css">

    <link rel="stylesheet" href="/css/nav.css">

    <style>
        body {
            justify-content: center; /* 水平居中 */
            align-items: center; /* 垂直居中 */
            background-color: #f8f9fa; /* 背景颜色可选 */
        }

        a {
            // 去除所有格式
            text-decoration: none;
            color: #343a40;
        }

        .row {
            margin-top: 0;
        }

        .form-div {
            margin-top: 50px;
        }

        form {
            background-color: #ffffff;
            margin: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .form-title {
            display: block;
            font-size: 24px; /* 字体大小 */
            font-weight: bold; /* 加粗 */
            color: #343a40; /* 颜色 */
            margin-bottom: 20px; /* 底部间距 */
            text-transform: uppercase; /* 全部大写（可选） */
            letter-spacing: 1px; /* 字间距（可选） */
        }

        .input-group {
            margin: 10px auto;
            width: 60%;
        }

        .input-desc {
            width: 100px;
        }

        input[type="submit"] {
            display: block;
            margin-top: 50px;
            padding: 10px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        input[type="submit"]:hover {
            background-color: #0056b3; /* 按钮悬停颜色 */
        }

    </style>

</head>

<body>

<script src="/js/jQuery-3.7.1.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/bootstrap-datetimepicker.js"></script>
<script src="/js/bootstrap-datetimepicker.zh-CN.js"></script>
<script src="/js/html5shiv.js"></script>
<script src="/js/respond.js"></script>

<div class="container-fluid">
    <div th:insert="~{nav :: nav}"></div>
    <form id="pound_form" method="post" action="/commit">
        <span class="form-title">新增磅单数据</span>

        <div class="input-group">
            <span class="input-group-addon input-desc">出入库类型</span>
            <select class="form-control" name="IOType" aria-describedby="basic-addon3">
                <option value="1">入库</option>
                <option value="0">出库</option>
            </select>
        </div>

        <div class="input-group">
            <span class="input-group-addon input-desc"><a href="/coalTypeEdit">煤种</a></span>
            <select class="form-control" name="coal-type" id="coal-type" aria-describedby="basic-addon3"
                    onchange="function toggleOtherInput() {
                        const coalTypeSelect = document.getElementById('coal-type');
                        const otherInput = document.getElementById('other-coal-type');
                        if (coalTypeSelect.value === 'other') {
                            otherInput.style.display = 'table';  // 显示输入框
                        } else {
                            otherInput.style.display = 'none';   // 隐藏输入框
                        }
                    }
                    toggleOtherInput()">
                <option th:each="coalType : ${coalTypes}" th:value="${coalType.name}"
                        th:text="${coalType.name}">
                </option>

                <option value="other">其他</option>
            </select>
        </div>
        <!-- 新增一个输入框，当选择"其他"时显示 -->
        <div class="input-group" id="other-coal-type" style="display:none;">
            <span class="input-group-addon input-desc">请输入新煤种</span>
            <input type="text" class="form-control" name="other-coal-type" aria-describedby="basic-addon3">
        </div>
        <div class="input-group">
            <span class="input-group-addon input-desc">车牌号</span>
            <input type="text" class="form-control" name="plate-number" aria-describedby="basic-addon3">
        </div>
        <div class="input-group">
            <span class="input-group-addon input-desc">毛重</span>
            <input type="text" class="form-control" name="gross-weight" aria-describedby="basic-addon3">
            <span class="input-group-addon">吨</span>
        </div>
        <div class="input-group">
            <span class="input-group-addon input-desc">皮重</span>
            <input type="text" class="form-control" name="tare" aria-describedby="basic-addon3">
            <span class="input-group-addon">吨</span>
        </div>
        <div class="input-group">
            <span class="input-group-addon input-desc">原发</span>
            <input type="text" class="form-control" name="primary-weight" aria-describedby="basic-addon3">
            <span class="input-group-addon">吨</span>
        </div>
        <div class="input-group">
            <script src='/js/form-date.js'></script>
            <span class="input-group-addon input-desc">过空时间</span>
            <input class="form-control" type="text" id="empty-load-time" name="empty-load-time"
                   aria-label="选择时间">
        </div>
        <div class="input-group">
            <script src='/js/form-date.js'></script>
            <span class="input-group-addon input-desc">过重时间</span>
            <input class="form-control" type="text" id="full-load-time" name="full-load-time"
                   aria-label="选择时间">
        </div>
        <div class="input-group">
            <span class="input-group-addon input-desc">发货单位</span>
            <input type="text" class="form-control" name="output-unit" aria-describedby="basic-addon3">
        </div>
        <div class="input-group">
            <span class="input-group-addon input-desc">收货单位</span>
            <input type="text" class="form-control" name="input-unit" aria-describedby="basic-addon3">
        </div>
        <div class="input-group">
            <span class="input-group-addon input-desc">司磅员</span>
            <select class="form-control" name="weigher" aria-describedby="basic-addon3">
                <option value="罗亚平">罗亚平</option>
            </select>
        </div>
        <input class="input-group" type="submit" value="提交"/>
        <div style="height: 20px"></div>

    </form>

</div>

</body>

<script src="/js/form-date.js"></script>
<script>
    // 初始化实时验证
    function initializeRealTimeValidation() {
        const form = document.getElementById('pound_form');

        // 为每个输入框绑定实时验证事件
        form['plate-number'].addEventListener('input', () => validateField(form['plate-number']));
        form['gross-weight'].addEventListener('input', () => validateField(form['gross-weight']));
        form['tare'].addEventListener('input', () => validateField(form['tare']));
        form['primary-weight'].addEventListener('input', () => validateField(form['primary-weight']));
        form['empty-load-time'].addEventListener('input', () => validateField(form['empty-load-time']));
        form['full-load-time'].addEventListener('input', () => validateField(form['full-load-time']));
        form['output-unit'].addEventListener('input', () => validateField(form['output-unit']));
        form['input-unit'].addEventListener('input', () => validateField(form['input-unit']));
        form['coal-type'].addEventListener('change', () => validateField(form['coal-type']));
        form['other-coal-type'].addEventListener('input', () => validateField(form['other-coal-type']));
    }

    // 验证单个字段
    function validateField(field) {
        resetFieldError(field);  // 清除之前的错误样式

        // 验证毛重、皮重和原发是否为数字（适用于相应字段）
        if (['gross-weight', 'tare', 'primary-weight'].includes(field.name) && isNaN(field.value)) {
            markFieldError(field, '必须为数字');
            return;
        }

        // 验证必填字段是否为空
        // if (!field.value.trim()) {
        //     markFieldError(field, '该字段不能为空');
        //     return;
        // }

        // 特定字段的验证（例如煤种选择）
        if (field.name === 'coal-type' && field.value === '') {
            markFieldError(field, '请选择煤种');
        }

        if (field.name === 'other-coal-type' && document.getElementById('coal-type').value === 'other' && !field.value.trim()) {
            markFieldError(field, '请输入新煤种');
        }
    }

    // 标记错误的输入框并显示错误信息
    function markFieldError(field, message) {
        field.style.borderColor = 'red';  // 给字段添加红色边框
        // const errorSpan = document.createElement('span');
        // errorSpan.classList.add('error-message');
        // errorSpan.style.color = 'red';
        // errorSpan.style.float = 'left';
        // errorSpan.style.display = 'block';
        // errorSpan.textContent = message;
        // field.parentNode.appendChild(errorSpan);
    }

    // 清除字段的错误样式
    function resetFieldError(field) {
        field.style.borderColor = '';  // 清除边框颜色
        const errorMessages = field.parentNode.querySelectorAll('.error-message');
        errorMessages.forEach(msg => msg.remove());  // 删除错误信息
    }

    // 提交前检查所有字段
    function validateForm() {
        let isValid = true;
        const form = document.getElementById('pound_form');

        // 遍历所有字段，进行验证
        const inputs = form.querySelectorAll('input, select');
        inputs.forEach(input => {
            if (input.name !== 'coal-type' && input.name !== 'other-coal-type') {
                validateField(input);  // 进行实时验证
                if (input.style.borderColor === 'red') {
                    isValid = false;  // 如果发现红色边框，表示有错误
                }
            }
        });

        // 如果表单无误，弹出确认框
        if (!isValid) {
            return confirm('存在错误的输入，请确认后继续提交。');
        }

        return true;  // 如果所有字段都通过验证，则允许提交
    }

    // 绑定表单提交事件
    document.getElementById('pound_form').onsubmit = validateForm;

    // 初始化实时验证
    initializeRealTimeValidation();
</script>


</html>

