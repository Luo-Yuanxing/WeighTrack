<!DOCTYPE HTML>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>鸿聚一号煤场出入库明细</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- nav.css   -->
    <link rel="stylesheet" href="/css/nav.css">

    <script src="/js/html5shiv.js"></script>
    <script src="/js/respond.js"></script>

    <style>
        /* 全局样式 */
        body {
            font-family: "Arial", sans-serif;
            background-color: #f8f9fa; /* 背景颜色 */
            color: #333; /* 全局字体颜色 */
            margin: 0;
            padding: 0;
        }

        h2 {
            text-align: center;
            margin: 10px auto;
            padding: 0;
        }

        /* 表格样式 */
        table {
            margin: 10px auto;
            width: 100%;
            border-collapse: collapse;
            background-color: #fff; /* 表格背景 */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* 添加阴影 */
            border-radius: 8px; /* 圆角 */
            overflow: hidden;
        }

        table tbody {
            display: block;
            height: 570px;
            overflow-y: scroll;
        }

        table thead, tbody tr {
            display: table;
            width: 100%;
            table-layout: fixed;/*重要  表格固定算法*/
        }

        table thead {/*留出滚动条的位置*/
            width: calc(100% - 1em)
        }

        table th, table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #ddd; /* 表格分隔线 */
        }

        table thead {
            background-color: #007bff; /* 表头背景颜色 */
            color: #fff; /* 表头文字颜色 */
        }

        table tbody tr:hover {
            background-color: #f1f1f1; /* 鼠标悬浮行的背景色 */
        }

        table tbody tr:nth-child(even) {
            background-color: #f9f9f9; /* 偶数行背景色 */
        }

        /* 链接样式 */
        a {
            text-decoration: none;
            color: #007bff;
        }

        a:hover {
            color: #0056b3;
        }

        td:not(.time, .options), th:not(.time, .options) {
            white-space: nowrap; /* 防止换行 */
            //overflow: hidden; /* 如果文本溢出，隐藏多余部分 */
            text-overflow: ellipsis; /* 超出部分用省略号表示 */
        }

        /* 按钮样式 */
        td a {
            display: block;
            white-space: nowrap;
            margin-top: 1px;
            padding: 0 10px;
            border-radius: 5px;
            background-color: #28a745; /* 按钮背景色 */
            color: white;
            margin-right: 1px;
            transition: background-color 0.3s ease;
        }

        td a:hover {
            background-color: #218838;
        }

        .time span {
            white-space: nowrap;
        }



        .grid-layout {
            display: grid;
            grid-template-rows: repeat(2, 1fr);    /* 定义两行 */
            gap: 1px;  /* 设置单元格之间的间隙 */
        }
        .grid-layout a {
            text-decoration: none;  /* 可选：去掉链接的下划线 */
            padding: 5px;
            border: 1px solid #ccc; /* 可选：为每个链接添加边框 */
            display: block; /* 使链接变为块级元素 */
            text-align: center;
        }
        .delete-record {
            grid-column: span 2;
            color: red; /* 设置字体颜色为红色 */
            font-weight: bold; /* 设置字体加粗 */
            text-decoration: none; /* 去除下划线 */
            padding: 5px 10px; /* 设置内边距 */
            background-color: #f8d7da; /* 背景色为浅红色 */
            border: 1px solid #f5c6cb; /* 边框为红色 */
            border-radius: 4px; /* 圆角边框 */
            transition: background-color 0.3s ease, color 0.3s ease; /* 添加平滑过渡效果 */
        }

        .delete-record:hover {
            background-color: #f5c6cb; /* 鼠标悬停时背景色变浅 */
            color: #721c24; /* 鼠标悬停时文字颜色变深 */
            cursor: pointer; /* 鼠标悬停时变成指针 */
        }

        .delete-record:active {
            background-color: #f1b0b7; /* 点击时背景色变浅 */
            color: #721c24; /* 点击时文字颜色变深 */
        }

    </style>


</head>

<body>

<script src="/js/jQuery-3.7.1.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/html5shiv.js"></script>
<script src="/js/respond.js"></script>
<script>
    function confirmDelete(id) {
        if (confirm("确定要删除这条记录吗？")) {
            $.ajax({
                url: '/delete/' + id, // 请求的URL
                type: 'GET', // 请求方式，GET 或 POST
                success: function () {
                    // 请求成功后的回调函数
                    alert('删除成功');
                    window.location.reload(); // 刷新页面
                },
                error: function () {
                    // 请求失败后的回调函数
                    alert('删除失败');
                }
            });
        }
    }
</script>

<div th:insert="~{nav :: nav}"></div>
<div th:switch="${IOType}">
    <div th:case="in">
        <h2>入库记录表</h2>
    </div>
    <div th:case="out">
        <h2>出库记录表</h2>
    </div>
    <div th:case="all">
        <h2>出入库总记录</h2>
    </div>
</div>

<table>
    <thead>
    <tr>
        <th>操作</th>
        <th>出入库<br>类型</th>
        <th>煤种</th>
        <th>磅单编号</th>
        <th>车牌号</th>
        <th>毛重</th>
        <th>皮重</th>
        <th>净重</th>
        <th>原发</th>
        <th>盈亏</th>
        <th class="time">打印<br>时间</th>
        <th>发货<br>单位</th>
        <th>收货<br>单位</th>
        <th>司磅员</th>
        <th th:if="${today} == true">已打印</th>
        <th style="display: none">id</th>
    </tr>
    </thead>
    <tbody id="tbody">
    <tr th:each="poundBillModel : ${poundBillModels}">
        <td class="options grid-layout">
            <a th:href="@{/update/{id}(id=${poundBillModel.id})}">修改</a>
            <a th:href="@{/print/{id}(id=${poundBillModel.id})}">打印</a>
            <a href="#" class="delete-record" th:onclick="'confirmDelete(' + ${poundBillModel.id} + ')'">删除</a>
        </td>

        <td th:text="${poundBillModel.IOType} == '1' ? '入库' : '出库'"></td>
        <td th:text="${poundBillModel.coalType}"></td>
        <td th:text="${poundBillModel.poundID}"></td>
        <td th:text="${poundBillModel.plateNumber}"></td>
        <td class="weights" th:text="${#numbers.formatDecimal(poundBillModel.grossWeight, 2, 2)}"></td>
        <td class="weights" th:text="${#numbers.formatDecimal(poundBillModel.tareWeight, 2, 2)}"></td>
        <td class="weights" th:text="${#numbers.formatDecimal(poundBillModel.netWeight, 2, 2)}"></td>
        <td th:if="${poundBillModel.IOType} == '1'" class="primaryWeight" th:text="${#numbers.formatDecimal(poundBillModel.primaryWeight, 2, 2)}"></td>
        <td th:if="${poundBillModel.IOType} == '0'" class="primaryWeight">NaN</td>

        <td th:if="${poundBillModel.IOType} == '1'" class="weights profit-loss-weight" th:text="${#numbers.formatDecimal(poundBillModel.profitLossWeight, 2, 2)}"></td>
        <td th:if="${poundBillModel.IOType} == '0'" class="weights profit-loss-weight">NaN</td>
        <td class="time">
            <span th:if="${#strings.isEmpty(poundBillModel.printTime)}">未打印</span>
            <span th:if="${not#strings.isEmpty(poundBillModel.printTime)}"
                  th:text="${#temporals.format(poundBillModel.printTime, 'HH:mm')}"></span><br/>
        </td>

        <td th:text="${poundBillModel.outputUnit}"></td>
        <td th:text="${poundBillModel.inputUnit}"></td>
        <td th:text="${poundBillModel.weigher}"></td>
        <td th:if="${today} == true" th:text="${poundBillModel.printed}==true?'是':'否'"></td>
        <td class="deleteRecord">

        </td>

        <td th:id="${poundBillModel.id}" th:text="${poundBillModel.id}" style="display: none"></td>
        <td class="creat-time" th:text="${#temporals.format(poundBillModel.creatTime, 'yyyy-MM-dd')}" style="display: none"></td>
    </tr>
    </tbody>
</table>

<div th:if="${#lists.isEmpty(poundBillModels)}">没有数据</div>


<script>
    <!-- 按日期插入空行-->
    function insertDateRow () {
        let rows = $("#tbody tr");
        let j = 0;

        for (let i = 1; i < rows.length; i++) {
            // 获取当前行的日期
            let currentDate = rows.eq(i).find('.creat-time').text();

            // 获取上一行的日期
            let prevDate = rows.eq(j).find('.creat-time').text();

            // 如果日期不同，则插入新的日期展示空行
            if (currentDate !== prevDate) {
                insertRowOfDateAfter(i, prevDate); // 在当前行后插入新行
                j = i; // 更新 j 为当前行的位置
            }
        }
    }

    // 插入辅助函数
    function insertRowOfDateAfter(n, date) {
        let newRow = $("<tr><td colspan='15'>日期&nbsp;<span>&#x2191;</span>： " + date + "</td></tr>");
        $("#tbody tr").eq(n-1).after(newRow);
    }

    $(function () {
        $('.profit-loss-weight').each(function () {
            let value = $(this).text();
            if ($(this).text() === 'NaN') {
                return;
            }
            // 获取该元素的数值
            value = parseFloat(value);

            // 如果值小于 -0.2，添加红色醒目
            if (value < -0.2 && value !== 0) {
                $(this).css({
                    "color": "#d32f2f",  // 使用更深的红色，增加可读性
                    "background-color": "#f8d7da",  // 使用柔和的粉红色背景
                    "border": "1px solid #f5c6cb",  // 添加边框，使背景颜色更有层次感
                    "padding": "0.2em 0.4em",  // 适当增加内边距，使内容更加舒适
                    "border-radius": "5px",  // 使背景块更圆润
                    "transition": "all 0.3s ease-in-out"  // 添加过渡效果，使样式更平滑
                });
            } else if (value > 0.2 && value !== 0) {
                $(this).css({
                    "color": "#45d32f",
                    "background-color": "#d7f8e1",
                    "border": "1px solid #6fdf5e",
                    "padding": "0.2em 0.4em",
                    "border-radius": "5px",
                    "transition": "all 0.3s ease-in-out"
                })
            }
        });

        insertDateRow();
    })

</script>


</body>

</html>

